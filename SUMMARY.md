# Rust Istanbul Source Map Transformer - é¡¹ç›®æ€»ç»“

## é¡¹ç›®æ¦‚è¿°

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªç”¨Rustè¯­è¨€ç¼–å†™çš„Istanbulè¦†ç›–ç‡æ•°æ®source mapè½¬æ¢å™¨ï¼Œæä¾›äº†ä¸JavaScriptç‰ˆæœ¬`istanbul-lib-source-maps`åº“ç›¸ä¼¼çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

## å®ç°çš„åŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½
- **Source Mapè½¬æ¢**: å°†ç”Ÿæˆä»£ç çš„è¦†ç›–ç‡æ•°æ®è½¬æ¢ä¸ºåŸå§‹æºä»£ç çš„è¦†ç›–ç‡æ•°æ®
- **å®Œæ•´è¦†ç›–ç‡æ”¯æŒ**: æ”¯æŒè¯­å¥(statements)ã€å‡½æ•°(functions)å’Œåˆ†æ”¯(branches)è¦†ç›–ç‡
- **JSONåºåˆ—åŒ–**: å®Œæ•´çš„JSONè¾“å…¥/è¾“å‡ºæ”¯æŒ
- **ç±»å‹å®‰å…¨**: åˆ©ç”¨Rustçš„ç±»å‹ç³»ç»Ÿç¡®ä¿æ•°æ®å®‰å…¨

### âœ… APIè®¾è®¡
- `SourceMapStore`: ä¸»è¦çš„è½¬æ¢å™¨ç±»
- `transform_coverage()`: æ ¸å¿ƒè½¬æ¢å‡½æ•°
- `transform_istanbul_coverage()`: ä¾¿æ·çš„JSONå¤„ç†å‡½æ•°
- `MappedCoverage`: è½¬æ¢åçš„è¦†ç›–ç‡æ•°æ®ç»“æ„

### âœ… æ•°æ®ç»“æ„
- `FileCoverage`: æ–‡ä»¶è¦†ç›–ç‡æ•°æ®
- `Location` & `Position`: æºä»£ç ä½ç½®ä¿¡æ¯
- `SourceMap`: Source mapæ•°æ®ç»“æ„
- `FunctionMeta` & `BranchMeta`: å‡½æ•°å’Œåˆ†æ”¯å…ƒæ•°æ®

## æŠ€æœ¯ç‰¹ç‚¹

### ğŸ¦€ Rustä¼˜åŠ¿
- **å†…å­˜å®‰å…¨**: é›¶æˆæœ¬æŠ½è±¡ï¼Œæ— åƒåœ¾å›æ”¶
- **ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- **æ€§èƒ½**: æ¥è¿‘C/C++çš„è¿è¡Œæ—¶æ€§èƒ½
- **å¹¶å‘å®‰å…¨**: å†…ç½®çš„çº¿ç¨‹å®‰å…¨ä¿è¯

### ğŸ“¦ ä¾èµ–ç®¡ç†
- `serde`: JSONåºåˆ—åŒ–/ååºåˆ—åŒ–
- `anyhow`: é”™è¯¯å¤„ç†
- `thiserror`: è‡ªå®šä¹‰é”™è¯¯ç±»å‹

## é¡¹ç›®ç»“æ„

```
rust-istanbul-sourcemap/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs              # åº“å…¥å£å’Œå…¬å…±ç±»å‹
â”‚   â”œâ”€â”€ sourcemap.rs        # Source mapè§£ç é€»è¾‘
â”‚   â”œâ”€â”€ transformer.rs      # æ ¸å¿ƒè½¬æ¢é€»è¾‘
â”‚   â”œâ”€â”€ main.rs            # ä¸»ç¨‹åºç¤ºä¾‹
â”‚   â””â”€â”€ bin/
â”‚       â””â”€â”€ example.rs      # è¯¦ç»†ç¤ºä¾‹ç¨‹åº
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ integration_tests.rs # é›†æˆæµ‹è¯•
â”œâ”€â”€ benches/
â”‚   â””â”€â”€ benchmark.rs        # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”œâ”€â”€ Cargo.toml             # é¡¹ç›®é…ç½®
â”œâ”€â”€ README.md              # ä½¿ç”¨æ–‡æ¡£
â””â”€â”€ SUMMARY.md             # é¡¹ç›®æ€»ç»“
```

## æµ‹è¯•è¦†ç›–

### âœ… å•å…ƒæµ‹è¯•
- `test_mapped_coverage_add_statement`: è¯­å¥è¦†ç›–ç‡æ·»åŠ 
- `test_mapped_coverage_add_function`: å‡½æ•°è¦†ç›–ç‡æ·»åŠ 
- `test_mapped_coverage_add_branch`: åˆ†æ”¯è¦†ç›–ç‡æ·»åŠ 
- `test_transform_coverage_with_source_map`: å¸¦source mapçš„è½¬æ¢
- `test_transform_coverage_without_source_map`: æ— source mapçš„è½¬æ¢

### âœ… é›†æˆæµ‹è¯•
- å®Œæ•´çš„ç«¯åˆ°ç«¯è½¬æ¢æµ‹è¯•
- JSONåºåˆ—åŒ–/ååºåˆ—åŒ–æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•

## æ€§èƒ½ç‰¹ç‚¹

### ğŸš€ ä¼˜åŒ–ç‚¹
- **é›¶æ‹·è´**: å°½å¯èƒ½é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶
- **å†…å­˜æ•ˆç‡**: Rustçš„æ‰€æœ‰æƒç³»ç»Ÿä¼˜åŒ–å†…å­˜ä½¿ç”¨
- **ç¼–è¯‘æ—¶ä¼˜åŒ–**: Rustç¼–è¯‘å™¨çš„å†…è”å’Œä¼˜åŒ–

### ğŸ“Š åŸºå‡†æµ‹è¯•
- æä¾›äº†CriterionåŸºå‡†æµ‹è¯•æ¡†æ¶
- å¯ä»¥æµ‹é‡è½¬æ¢æ€§èƒ½
- æ”¯æŒæ€§èƒ½å›å½’æ£€æµ‹

## ä¸JavaScriptç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | JavaScriptç‰ˆæœ¬ | Rustç‰ˆæœ¬ | ä¼˜åŠ¿ |
|------|---------------|----------|------|
| ç±»å‹å®‰å…¨ | âŒ | âœ… | ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥ |
| å†…å­˜å®‰å…¨ | âŒ | âœ… | æ— å†…å­˜æ³„æ¼/æ‚¬ç©ºæŒ‡é’ˆ |
| è¿è¡Œæ—¶æ€§èƒ½ | ä¸­ç­‰ | é«˜ | æ¥è¿‘åŸç”Ÿæ€§èƒ½ |
| å¹¶å‘å®‰å…¨ | æœ‰é™ | ä¼˜ç§€ | å†…ç½®çº¿ç¨‹å®‰å…¨ |
| é”™è¯¯å¤„ç† | å¼‚å¸¸ | Resultç±»å‹ | æ˜¾å¼é”™è¯¯å¤„ç† |
| ç”Ÿæ€ç³»ç»Ÿ | ä¸°å¯Œ | æˆé•¿ä¸­ | JavaScriptæ›´æˆç†Ÿ |
| å­¦ä¹ æ›²çº¿ | ä½ | ä¸­ç­‰ | Rustéœ€è¦æ›´å¤šå­¦ä¹  |

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•
```rust
use istanbul_sourcemap::transform_istanbul_coverage;

let result = transform_istanbul_coverage(json_data)?;
println!("{}", result);
```

### é«˜çº§ç”¨æ³•
```rust
use istanbul_sourcemap::{SourceMapStore, CoverageMap};

let store = SourceMapStore::new();
let transformed = store.transform_coverage(coverage_map)?;
```

## è¿è¡Œç»“æœ

### æˆåŠŸçš„æµ‹è¯•è¿è¡Œ
```
running 8 tests
test test_mapped_coverage_add_branch ... ok
test test_transform_coverage_without_source_map ... ok
test test_location_string_formatting ... ok
test test_transform_coverage_with_source_map ... ok
test test_transform_istanbul_coverage_function ... ok
test test_mapped_coverage_add_function ... ok
test test_unique_key_generation ... ok
test test_mapped_coverage_add_statement ... ok

test result: ok. 8 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

### ç¤ºä¾‹è¾“å‡º
ç¨‹åºæˆåŠŸå°†`dist/app.js`çš„è¦†ç›–ç‡æ•°æ®è½¬æ¢ä¸º`src/app.ts`çš„è¦†ç›–ç‡æ•°æ®ï¼Œä¿æŒäº†æ‰€æœ‰çš„è¯­å¥ã€å‡½æ•°å’Œåˆ†æ”¯è¦†ç›–ç‡ä¿¡æ¯ã€‚

## é™åˆ¶å’Œæ”¹è¿›ç©ºé—´

### å½“å‰é™åˆ¶
1. **ç®€åŒ–çš„VLQè§£ç **: ä½¿ç”¨äº†åŸºç¡€çš„source mapè§£ç å®ç°
2. **è·¯å¾„å¤„ç†**: ç®€åŒ–çš„ç›¸å¯¹è·¯å¾„å¤„ç†
3. **é”™è¯¯æ¢å¤**: åŸºç¡€çš„é”™è¯¯å¤„ç†æœºåˆ¶

### æœªæ¥æ”¹è¿›
1. **å®Œæ•´VLQè§£ç **: å®ç°å®Œæ•´çš„source map VLQè§£ç ç®—æ³•
2. **å¼‚æ­¥æ”¯æŒ**: æ·»åŠ å¼‚æ­¥I/Oæ”¯æŒ
3. **ç¼“å­˜æœºåˆ¶**: å®ç°source mapç¼“å­˜
4. **CLIå·¥å…·**: åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·
5. **æ’ä»¶ç³»ç»Ÿ**: æ”¯æŒæ‰©å±•åŠŸèƒ½

## ç»“è®º

è¿™ä¸ªRustå®ç°æˆåŠŸåœ°å¤åˆ¶äº†JavaScriptç‰ˆæœ¬çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒæ—¶æä¾›äº†ï¼š

- **æ›´å¥½çš„ç±»å‹å®‰å…¨**: ç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
- **æ›´é«˜çš„æ€§èƒ½**: æ¥è¿‘åŸç”Ÿä»£ç çš„æ‰§è¡Œé€Ÿåº¦
- **æ›´å¥½çš„å†…å­˜å®‰å…¨**: æ— å†…å­˜æ³„æ¼å’Œæ‚¬ç©ºæŒ‡é’ˆ
- **æ›´å¥½çš„å¹¶å‘æ”¯æŒ**: å†…ç½®çš„çº¿ç¨‹å®‰å…¨ä¿è¯

é¡¹ç›®å±•ç¤ºäº†å¦‚ä½•å°†JavaScriptç”Ÿæ€ç³»ç»Ÿä¸­çš„å·¥å…·ç§»æ¤åˆ°Rustï¼ŒåŒæ—¶ä¿æŒåŠŸèƒ½å®Œæ•´æ€§å’Œæå‡æ€§èƒ½ã€‚è¿™ä¸ºéœ€è¦é«˜æ€§èƒ½è¦†ç›–ç‡å¤„ç†çš„åœºæ™¯æä¾›äº†ä¸€ä¸ªä¼˜ç§€çš„æ›¿ä»£æ–¹æ¡ˆã€‚